Vagrant.configure("2") do |config|
  config.vm.box = "bento/ubuntu-22.04"  # ARM-compatible box

  config.vm.define "app-server" do |server|
    server.vm.hostname = "app-server"
    server.vm.network "private_network", ip: "192.168.56.30"
    server.vm.network "forwarded_port", guest: 8000, host: 8000

    # Auto-detect provider
    server.vm.provider "vmware_desktop" do |v|
      v.vmx["memsize"] = "1024"
      v.vmx["numvcpus"] = "1"
    end

    server.vm.provider "parallels" do |prl|
      prl.memory = 1024
      prl.cpus = 1
    end

    server.vm.provider "virtualbox" do |vb|
      vb.memory = "1024"
      vb.cpus = 1
      vb.name = "ramops-hardlink"
    end

    server.vm.provider "qemu" do |qe|
      qe.memory = "1024"
      qe.cpus = 1
      qe.ssh_port = 50022
      qe.arch = "aarch64"
      qe.machine = "virt,accel=hvf,highmem=off"
      qe.cpu = "max"
      qe.net_device = "virtio-net-pci"
    end

    server.vm.provision "shell", path: "scripts/provision.sh"
  end
end
