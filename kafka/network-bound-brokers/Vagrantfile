Vagrant.configure("2") do |config|
  config.vm.box = "ubuntu/jammy64"

  # Kafka Broker 1
  config.vm.define "kafka1" do |broker|
    broker.vm.hostname = "kafka1"
    broker.vm.network "private_network", ip: "192.168.56.11"

    broker.vm.provider "virtualbox" do |vb|
      vb.memory = "2048"
      vb.cpus = 2
      vb.name = "ramops-net-kafka1"
    end

    broker.vm.provision "shell", path: "scripts/provision-broker.sh", args: ["1", "192.168.56.11"]
  end

  # Kafka Broker 2
  config.vm.define "kafka2" do |broker|
    broker.vm.hostname = "kafka2"
    broker.vm.network "private_network", ip: "192.168.56.12"

    broker.vm.provider "virtualbox" do |vb|
      vb.memory = "2048"
      vb.cpus = 2
      vb.name = "ramops-net-kafka2"
    end

    broker.vm.provision "shell", path: "scripts/provision-broker.sh", args: ["2", "192.168.56.12"]
  end

  # Kafka Broker 3
  config.vm.define "kafka3" do |broker|
    broker.vm.hostname = "kafka3"
    broker.vm.network "private_network", ip: "192.168.56.13"

    broker.vm.provider "virtualbox" do |vb|
      vb.memory = "2048"
      vb.cpus = 2
      vb.name = "ramops-net-kafka3"
    end

    broker.vm.provision "shell", path: "scripts/provision-broker.sh", args: ["3", "192.168.56.13"]
  end

  # Monitoring VM (Prometheus + Grafana)
  config.vm.define "monitoring" do |mon|
    mon.vm.hostname = "monitoring"
    mon.vm.network "private_network", ip: "192.168.56.20"
    mon.vm.network "forwarded_port", guest: 3000, host: 3000  # Grafana
    mon.vm.network "forwarded_port", guest: 9090, host: 9090  # Prometheus

    mon.vm.provider "virtualbox" do |vb|
      vb.memory = "2048"
      vb.cpus = 1
      vb.name = "ramops-net-monitoring"
    end

    mon.vm.provision "shell", path: "scripts/provision-monitoring.sh"
  end
end
